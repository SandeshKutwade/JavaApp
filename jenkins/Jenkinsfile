pipeline {
    agent any

    tools {
        maven 'maventool' 
    }

    environment {
        SONARQUBE_ENV = 'SonarCloud'
    }

    stages {

        stage('Build with Maven') {
            steps {
                // Clean and package the application using Maven
                sh 'mvn clean package'
            }
        }

        stage('build with sonar') {
		steps {
			withSonarQubeEnv(credentialsId: 'sandeshkutwade123', installationName: 'SONAR_SCANNER') { // You can override the credential to be used
				sh '/opt/maven/bin/mvn clean package org.sonarsource.scanner.maven:sonar-maven-plugin:3.7.0.1746:sonar -D sonar.organization=SandeshKutwade/JavaApp -D sonar.projectKey=85e0a170c4e35ec5735204771fc8f4a4e07e82b5'
			}
			junit testResults: '**/surefire-reports/*.xml'
			// archive '**/target/spring-petclinic-*.jar'
		}
	}

        stage('Build Docker Image') {
            steps {
                // Build the Docker image using the Dockerfile
                sh 'docker build -t hello-world-app .'
            }
        }

        stage('Run Docker Container') {
            steps {
                // Run the Docker container on a different port (e.g., 8081)
                sh 'docker run -d -p 8081:8080 --name hello-world-app hello-world-app'
            }
        }
    }

    // post {
    //     always {
    //         // Clean up the Docker container after the build
    //         sh 'docker stop hello-world-app || true'
    //         sh 'docker rm hello-world-app || true'
    //     }
    // }
}







	
	// stage("Quality Gate") {
	// 	steps {
	// 		timeout(time: 1, unit: 'HOURS') {
	// 			// Parameter indicates whether to set pipeline to UNSTABLE if Quality Gate fails
	// 			// true = set pipeline to UNSTABLE, false = don't
	// 			waitForQualityGate abortPipeline: true
	// 		}
	// 	}
	// }
	
//   }
    
// }